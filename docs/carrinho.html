<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho - Da Horta Distribuidora</title>
    <meta name="description" content="Finalize seu pedido de produtos frescos">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Banner Header -->
    <div class="banner-header" onclick="goToHome()" style="cursor: pointer;" title="Clique para voltar √† home">
        <img src="images/Header_da_horta.png" alt="Da Horta Distribuidora" class="banner-image">
    </div>

    <!-- Navigation Header -->
    <header class="main-header">
        <div class="header-content">
            <button class="menu-toggle" id="menuToggle" aria-label="Abrir menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <div class="header-actions">
                <button class="search-btn" id="searchBtn" aria-label="Buscar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
                
                <a href="carrinho.html" class="cart-btn active" aria-label="Carrinho">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span class="cart-badge" id="cartBadge">0</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Side Menu -->
    <nav class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <button class="menu-close" id="menuClose" aria-label="Fechar menu">√ó</button>
        </div>
        <ul class="side-menu-list">
            <li><a href="index.html">üè† In√≠cio</a></li>
            <li><a href="carrinho.html" class="active">üõí Carrinho</a></li>
            <li><a href="login.html">üë§ Entrar</a></li>
        </ul>
    </nav>

    <!-- Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay"></div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <input type="text" id="searchInput" placeholder="Buscar produtos..." class="search-input">
            <button class="search-close" id="searchClose">√ó</button>
        </div>
        <div class="search-results" id="searchResults"></div>
    </div>

    <!-- Main Content -->
    <main class="container cart-page">
        <h1 class="page-title">Carrinho de Compras</h1>
        
        <!-- Empty Cart -->
        <div class="empty-cart-page" id="emptyCartPage" style="display: none;">
            <div class="empty-icon">üõí</div>
            <h2>Seu carrinho est√° vazio</h2>
            <p>Adicione produtos para come√ßar seu pedido</p>
            <a href="index.html" class="btn-primary">Ver Produtos</a>
        </div>

        <!-- Cart Content -->
        <div class="cart-page-content" id="cartPageContent">
            <div class="cart-grid">
                <!-- Cart Items -->
                <div class="cart-items-section">
                    <h2>Itens do Pedido</h2>
                    <div id="cartItemsList"></div>
                </div>

                <!-- Order Summary -->
                <div class="order-summary-section">
                    <div class="summary-card">
                        <h2>Resumo do Pedido</h2>
                        <div class="summary-line">
                            <span>Subtotal:</span>
                            <span id="summarySubtotal">R$ 0,00</span>
                        </div>
                        <div class="summary-line">
                            <span>Taxa de Entrega:</span>
                            <span id="summaryDelivery" class="text-muted">Calcular no checkout</span>
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-line total">
                            <span>Total:</span>
                            <span id="summaryTotal">R$ 0,00</span>
                        </div>
                        <button class="btn-checkout" onclick="proceedToCheckout()">
                            Continuar para Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Checkout Section -->
        <div class="checkout-section" id="checkoutSection" style="display: none;">
            <button class="back-link" onclick="backToCart()">‚Üê Voltar para o Carrinho</button>
            
            <h1 class="page-title">Finalizar Pedido</h1>

            <form id="checkoutForm" class="checkout-form">
                <!-- Business Information -->
                <div class="form-card">
                    <h2>Dados da Empresa</h2>
                    <div class="form-group">
                        <label for="businessType">Tipo de Estabelecimento *</label>
                        <select id="businessType" required>
                            <option value="">Selecione...</option>
                            <option value="restaurante">Restaurante</option>
                            <option value="hotel">Hotel</option>
                            <option value="mercado">Mercado</option>
                            <option value="padaria">Padaria</option>
                            <option value="lanchonete">Lanchonete</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cnpj">CNPJ *</label>
                            <input type="text" id="cnpj" placeholder="00.000.000/0000-00" required maxlength="18">
                        </div>
                        <div class="form-group">
                            <label for="ie">Inscri√ß√£o Estadual</label>
                            <input type="text" id="ie" placeholder="000.000.000.000">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="razaoSocial">Raz√£o Social *</label>
                        <input type="text" id="razaoSocial" required>
                    </div>

                    <div class="form-group">
                        <label for="nomeFantasia">Nome Fantasia *</label>
                        <input type="text" id="nomeFantasia" required>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="form-card">
                    <h2>Contato</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactName">Nome do Respons√°vel *</label>
                            <input type="text" id="contactName" required>
                        </div>
                        <div class="form-group">
                            <label for="contactPhone">Telefone *</label>
                            <input type="tel" id="contactPhone" placeholder="(11) 99999-9999" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">E-mail *</label>
                        <input type="email" id="contactEmail" required>
                    </div>
                </div>

                <!-- Delivery Address -->
                <div class="form-card">
                    <h2>Endere√ßo de Entrega</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cep">CEP *</label>
                            <input type="text" id="cep" placeholder="00000-000" required maxlength="9">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-secondary" onclick="calculateDelivery()">
                                üìç Calcular Frete
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="street">Endere√ßo *</label>
                        <input type="text" id="street" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="number">N√∫mero *</label>
                            <input type="text" id="number" required>
                        </div>
                        <div class="form-group">
                            <label for="complement">Complemento</label>
                            <input type="text" id="complement">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="neighborhood">Bairro *</label>
                            <input type="text" id="neighborhood" required>
                        </div>
                        <div class="form-group">
                            <label for="city">Cidade *</label>
                            <input type="text" id="city" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="state">Estado *</label>
                        <input type="text" id="state" placeholder="SP" required maxlength="2">
                    </div>

                    <!-- Delivery Info -->
                    <div id="deliveryInfo" class="delivery-estimate-card hidden">
                        <div class="estimate-header">
                            <span class="estimate-icon">‚úÖ</span>
                            <h3>Frete Calculado!</h3>
                        </div>
                        <div class="estimate-body">
                            <div class="estimate-row">
                                <div class="estimate-item distance">
                                    <span class="estimate-icon-sm">üìè</span>
                                    <div class="estimate-info">
                                        <span class="estimate-label">Dist√¢ncia</span>
                                        <span class="estimate-value" id="deliveryDistance">-</span>
                                    </div>
                                </div>
                                <div class="estimate-item time">
                                    <span class="estimate-icon-sm">‚è±Ô∏è</span>
                                    <div class="estimate-info">
                                        <span class="estimate-label">Tempo</span>
                                        <span class="estimate-value" id="deliveryTime">-</span>
                                    </div>
                                </div>
                            </div>
                            <div class="estimate-divider"></div>
                            <div class="estimate-fee">
                                <span class="estimate-icon-lg">üöö</span>
                                <div class="estimate-fee-info">
                                    <span class="estimate-label">Taxa de Entrega</span>
                                    <span class="estimate-price" id="deliveryFee">R$ 0,00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment and Observations -->
                <div class="form-card">
                    <h2>Pagamento e Observa√ß√µes</h2>
                    <div class="form-group">
                        <label for="paymentMethod">Forma de Pagamento *</label>
                        <select id="paymentMethod" required>
                            <option value="">Selecione...</option>
                            <option value="boleto">Boleto Banc√°rio</option>
                            <option value="transferencia">Transfer√™ncia Banc√°ria</option>
                            <option value="cartao">Cart√£o de Cr√©dito Empresarial</option>
                            <option value="prazo">Pagamento a Prazo (15/30 dias)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="observations">Observa√ß√µes</label>
                        <textarea id="observations" rows="4" placeholder="Informa√ß√µes adicionais sobre o pedido..."></textarea>
                    </div>
                </div>

                <!-- Order Summary Final -->
                <div class="form-card final-summary">
                    <h2>Resumo Final do Pedido</h2>
                    <div id="finalCartItems" class="final-items-list"></div>
                    
                    <div class="summary-totals">
                        <div class="summary-line">
                            <span>Subtotal:</span>
                            <span id="finalSubtotal">R$ 0,00</span>
                        </div>
                        <div class="summary-line">
                            <span>Taxa de Entrega:</span>
                            <span id="finalDeliveryFee">R$ 0,00</span>
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-line total large">
                            <span>Total do Pedido:</span>
                            <span id="finalTotal">R$ 0,00</span>
                        </div>
                    </div>

                    <button type="submit" class="btn-finalize">
                        ‚úì Finalizar Pedido
                    </button>
                </div>
            </form>
        </div>

        <!-- Success Modal -->
        <div class="modal" id="successModal">
            <div class="modal-content success">
                <div class="success-icon">‚úÖ</div>
                <h2>Pedido Realizado com Sucesso!</h2>
                <p class="success-message">Seu pedido foi registrado e em breve entraremos em contato.</p>
                <div class="order-details">
                    <p><strong>N√∫mero do Pedido:</strong> <span id="orderNumber">-</span></p>
                    <p><strong>Total:</strong> <span id="orderTotal">-</span></p>
                    <p><strong>Previs√£o de Entrega:</strong> <span id="orderDelivery">-</span></p>
                </div>
                <button class="btn-primary" onclick="closeSuccessModal()">Fazer Novo Pedido</button>
            </div>
        </div>
    </main>

    <!-- API Scripts -->
    <script src="config.js"></script>
    <script src="api-client.js"></script>
    <script src="auth.js"></script>
    <script src="cart.js"></script>
    <script>
        // Ir para home
        function goToHome() {
            window.location.href = 'index.html';
        }

        // Menu Toggle
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const menuClose = document.getElementById('menuClose');
            const menuOverlay = document.getElementById('menuOverlay');
            const sideMenu = document.getElementById('sideMenu');
            const searchBtn = document.getElementById('searchBtn');
            const searchModal = document.getElementById('searchModal');
            const searchClose = document.getElementById('searchClose');
            const searchInput = document.getElementById('searchInput');

            // Open menu
            menuToggle?.addEventListener('click', () => {
                sideMenu?.classList.add('active');
                menuOverlay?.classList.add('active');
            });

            // Close menu
            const closeMenu = () => {
                sideMenu?.classList.remove('active');
                menuOverlay?.classList.remove('active');
            };
            menuClose?.addEventListener('click', closeMenu);
            menuOverlay?.addEventListener('click', closeMenu);

            // Search modal
            searchBtn?.addEventListener('click', () => {
                searchModal?.classList.add('active');
                searchInput?.focus();
            });

            searchClose?.addEventListener('click', () => {
                searchModal?.classList.remove('active');
            });

            searchModal?.addEventListener('click', (e) => {
                if (e.target === searchModal) {
                    searchModal.classList.remove('active');
                }
            });

            // Search functionality
            searchInput?.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const resultsDiv = document.getElementById('searchResults');
                
                if (!query || !resultsDiv) {
                    if (resultsDiv) resultsDiv.innerHTML = '';
                    return;
                }

                // Redirect to index with search
                window.location.href = `index.html?search=${encodeURIComponent(query)}`;
            });
        });
    </script>
</body>
</html>

